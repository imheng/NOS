#第十一节课
##死锁
###1．死锁概念：
　　是指两个或两个以上的进程在执行过程中，由于争夺资源而造成的一种互相等待的现象。
###2．产生死锁的条件：
   　（1）互斥条件：临界资源是独占资源，一个资源每次只能被一个进程使用。

   　（2）占有和等待条件：进程在请求资源得不到满足而等待时，不释放已占有资源。

   　（3）不剥夺条件：一个进程对已获得的资源在未使用完毕之前，不能被其他进程强行剥夺，只能由该进程资源释放。

   　（4）循环等待条件：多个进程之间形成一种头尾相接的循环等待资源关系，即前一个进程占有后一个进程所请求的资源。

　注：当发生死锁时，以上四个条件一定是同时满足，如果其中任意一个条件不满足，死锁就不会发生。
###3．死锁防止策略：
　　　（1）破坏互斥条件：不容许提供共享资源或尽可能要求使用非共享数据。

　　　（2）破坏占有和等待条件：要求当一个进程请求资源时，先暂时释放其当前占用的所有资源，然后再尝试一次获得所需的所有的资源。

　　　（3）破坏不剥夺条件：改为剥夺条件，即允许剥夺其他进程的资源。

　　　（4）破坏循坏等待条件：要求所有的资源请求都进行排队。
###4．处理死锁的方法：
　　　（1）预防死锁：通过设置某些限制条件，去破坏产生死锁的四个必要条件中的一个或几个来预防产生死锁。

　　　（2）避免死锁：在资源的动态分配过程中，用某种方法防止系统进入不安全状态，从而避免发生死锁。

　　　（3）检测死锁：通过检测机构及时的检测出死锁的发生，然后采取适当的措施，把进程从死锁中解脱出来。

　　　（4）解除死锁：当检测到系统中已发生死锁时，就采取相应的措施，把进程从死锁中解脱出来。常用的方法是撤销一些进程，回收它们的资源，将资源分配给已处于阻塞状态的进程，使其能继续运行。
###5．资源分配图
![资源分配图](http://github.com/wangjuanli/Markdown/blob/master/%E8%BF%9B%E7%A8%8B-%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E5%9B%BE.png)

  进程集合：P={P1,P2,P3}；

  资源集合：R={R1,R2,R3,R4}；

资源使用集合P->R={ P1->R1,P2->R2,R1->P2,R2->P3, R3->P1,R3->P2}

资源实例：R1有1个实例，R2有1个实例，R3有2个实例，R4有3个实例。

进程状态：进程P1占有资源R3的一个实例，等待R1的一个实例，进程P2分别占有R1和R3的一个实例，等待R2的一个实例，进程P3占有R2的一个实例。

####根据对进程-资源分配图的分析和简化，来检测系统是否处于死锁状态：
　　（1）若图中无环路，则一定不会发生死锁；

　　（2）若图中有环路，且每个资源类中仅有一个资源，则系统中发生死锁；

　　如图1所示，当P3->R3时，出现环路P1->R1->P2->R2->P3->R3->P1此时发生死锁。

　　（3）若图中有环路，且所涉及的资源类中有多个资源，此时系统不一定会发生死锁。

　　如图1所示，当P3->R3时，出现环路P2->R2->P3->R3->P2此时不产生死锁。
